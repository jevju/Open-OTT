(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{13:function(e,t,i){},14:function(e,t,i){"use strict";i.r(t);var n=i(0),s=i.n(n),a=i(7),l=i.n(a),r=(i(13),i(1)),o=i(2),u=i(4),c=i(3),d=i(5),h=(s.a.Component,function(e){Object(u.a)(i,e);var t=Object(c.a)(i);function i(e){return Object(r.a)(this,i),t.call(this)}return Object(o.a)(i,[{key:"renderButton",value:function(){return s.a.createElement("div",{style:{position:"relative",textAlign:"center",width:"100%"}},s.a.createElement("div",{style:{borderRadius:"8px",textAlign:"center",display:"inline-block",position:"relative"}},s.a.createElement("div",{className:"btn",style:{border:"2px solid gray",borderRadius:"8px",fontSize:"15px",fontWeight:"bold",width:"100%",height:"100%"},onClick:this.props.onClick},this.props.text)))}},{key:"renderInput",value:function(){var e=this;return s.a.createElement("div",{style:{position:"relative",overflow:"hidden",textAlign:"center",width:"100%",height:"100%"}},s.a.createElement("div",{className:"btn",style:{borderRadius:"8px",textAlign:"center",display:"inline-block",position:"relative",width:"100%"}},s.a.createElement("button",{style:{border:"2px solid gray",color:"inherit",borderRadius:"8px",fontSize:"20px",fontWeight:"bold",backgroundColor:"inherit",width:"100%",height:"100%"}},this.props.text),s.a.createElement("input",{type:"file",accept:"*/*",multiple:!0,style:{height:"100%",position:"absolute",top:"0",left:"0",opacity:"0",cursor:"pointer",width:"100%"},onChange:function(t){e.props.onClick(t)}})))}},{key:"render",value:function(){return"input"===this.props.type?s.a.createElement("div",null,this.renderInput()):"button"===this.props.type?s.a.createElement("div",null,this.renderButton()):null}}]),i}(s.a.Component));s.a.Component;i.p;i.p,s.a.Component;function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function g(e,t){if(null==e)return{};var i,n,s=function(e,t){if(null==e)return{};var i,n,s={},a=Object.keys(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||(s[i]=e[i]);return s}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}var p=s.a.createElement("path",{d:"M30.3 13.7L25 8.4l-5.3 5.3-1.4-1.4L25 5.6l6.7 6.7z"}),v=s.a.createElement("path",{d:"M24 7h2v21h-2z"}),m=s.a.createElement("path",{d:"M35 40H15c-1.7 0-3-1.3-3-3V19c0-1.7 1.3-3 3-3h7v2h-7c-.6 0-1 .4-1 1v18c0 .6.4 1 1 1h20c.6 0 1-.4 1-1V19c0-.6-.4-1-1-1h-7v-2h7c1.7 0 3 1.3 3 3v18c0 1.7-1.3 3-3 3z"}),y=function(e){var t=e.svgRef,i=e.title,n=g(e,["svgRef","title"]);return s.a.createElement("svg",f({viewBox:"0 0 50 50",enableBackground:"new 0 0 50 50",ref:t},n),i?s.a.createElement("title",null,i):null,p,v,m)},E=s.a.forwardRef((function(e,t){return s.a.createElement(y,f({svgRef:t},e))})),b=(i.p,s.a.Component,function(e){Object(u.a)(i,e);var t=Object(c.a)(i);function i(e){return Object(r.a)(this,i),t.call(this,e)}return Object(o.a)(i,[{key:"renderSuggestion",value:function(){return s.a.createElement("div",{style:{position:"relative"}},s.a.createElement("img",{style:{float:"left"},src:this.props.imgUrl}),s.a.createElement("div",{style:{}},s.a.createElement("div",null,this.props.title),s.a.createElement("div",null,this.props.year)))}},{key:"renderCover",value:function(){return s.a.createElement("div",{style:{position:"relative"}},s.a.createElement("div",{style:{}},s.a.createElement("img",{style:{},src:this.props.imgUrl}),s.a.createElement("div",{style:{position:"absolute",bottom:"0",left:"50%",transform:"translate(-50%, -20%)"}},this.props.title)))}},{key:"render",value:function(){return"suggestion"===this.props.type?this.renderSuggestion():"cover"===this.props.type?this.renderCover():s.a.createElement("div",null,"Empty")}}]),i}(s.a.Component)),w=function(e){Object(u.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this)).state={files:[],initQue:[],selectedQue:[],waitingQue:[],uploadingQue:[],finishedQue:[],existQue:[]},n.max_simultanous_uploads=1,n.max_file_selections=2,n.onSelect=n.onSelect.bind(Object(d.a)(n)),n.onSuggestionChange=n.onSuggestionChange.bind(Object(d.a)(n)),n.onUpload=n.onUpload.bind(Object(d.a)(n)),n.onDelete=n.onDelete.bind(Object(d.a)(n)),n}return Object(o.a)(i,[{key:"componentDidUpdate",value:function(){if(this.state.initQue.length>0&&this.state.selectedQue.length<this.max_file_selections){var e=this.state.initQue[0],t=this.state.files[e];if("server"in t)if(t.server.size_uploaded>=t.server.size)this.queAdd("exist",e),this.queRemove("init",e);else if("suggestions"in t)this.max_file_selections>=this.state.selectedQue.length&&(this.queAdd("selected",e),this.queRemove("init",e));else{var i=t.name;i.includes("(")&&(i=i.split("(",1)[0]),i.includes(".")&&(i=i.split(".",1)[0]),this.getSuggestions(i,e)}else this.getFileInfo(e)}if(this.state.waitingQue.length>0&&this.state.uploadingQue.length<this.max_simultanous_uploads){var n=this.state.waitingQue[0];this.queAdd("uploading",n),this.queRemove("waiting",n);var s=this.state.files;s[n].uploading=!0,this.setState({files:s},this.upload(n))}}},{key:"getFileInfo",value:function(e){var t=this,i="?";i+="size="+String(this.state.files[e].size),i+="&name="+this.state.files[e].name,i+="&lastModified="+this.state.files[e].lastModified,fetch("/library/info/file"+i).then((function(e){if(e.ok)return e.json();throw new Error("File info request not accepted")})).then((function(i){var n=t.state.files;n[e].server=i,t.setState({files:n})})).catch((function(i){var n=t.state.files;n[e].statusMessage="Unable to access server",t.setState({files:n})}))}},{key:"getSuggestions",value:function(e,t){var i=this;e.length<1||fetch("/metadata/movie/"+("?search="+e)).then((function(e){if(e.ok)return e.json();throw new Error("Unable to get suggestions")})).then((function(e){var n;e.length>0?((n=i.state.files)[t].suggestions=e,n[t].suggestedIdx||(n[t].suggestedIdx=0),i.setState({files:n})):((n=i.state.files)[t].suggestions=null,n[t].suggestedIdx=null,i.setState({files:n}))})).catch((function(e){console.log(e)}))}},{key:"prepareInit",value:function(e){var t="?";return t+="type=init",t+="&id="+this.state.files[e].suggestions[this.state.files[e].suggestedIdx].id,t+="&size="+String(this.state.files[e].size),t+="&name="+this.state.files[e].name,t+="&lastModified="+this.state.files[e].lastModified}},{key:"prepareChunk",value:function(e){var t="?";return t+="type=chunk",t+="&offset="+String(this.state.files[e].server.size_uploaded),t+="&upload_id="+this.state.files[e].server.id}},{key:"prepareComplete",value:function(e){var t="?";return t+="type=complete",t+="&id="+this.state.files[e].suggestions[this.state.files[e].suggestedIdx].id,t+="&upload_id="+this.state.files[e].server.id}},{key:"upload",value:function(e){var t=this;if("uploading"in this.state.files[e]&&this.state.files[e].uploading)if("initiated"in this.state.files[e])if(this.state.files[e].server.size_uploaded<this.state.files[e].server.size){var i=this.state.files[e].server.size_uploaded;if(i>=this.state.files[e].size)return;this.state.files[e].server;var n=this.prepareChunk(e),s=this.state.files[e].file.slice(i,i+20971520);fetch("/library/upload/"+n,{method:"POST",body:s}).then((function(e){if(e.ok)return e.json();throw new Error("Upload failed")})).then((function(i){var n=t.state.files;t.state.files[e].server.size_uploaded=i.offset,t.setState({files:n},t.upload(e))})).catch((function(e){console.log(e)}))}else{console.log("complete now");var a=this.prepareComplete(e);fetch("/library/upload/"+a).then((function(i){if(!i.ok)throw new Error("Upload complete failed");console.log("upload complete"),t.queAdd("finished",e),t.queRemove("uploading",e)})).catch((function(e){console.log(e)}))}else n=this.prepareInit(e),fetch("/library/upload/"+n).then((function(e){if(e.ok)return e.json();throw new Error("Init not accepted")})).then((function(i){var n=t.state.files;t.state.files[e].initiated=!0,t.setState({files:n},t.upload(e))})).catch((function(e){console.log(e)}))}},{key:"queAdd",value:function(e,t){if("init"===e)(i=this.state.initQue).push(t),this.setState({initQue:i});else if("selected"===e){var i;(i=this.state.selectedQue).push(t),this.setState({selectedQue:i})}else"waiting"===e?((i=this.state.waitingQue).push(t),this.setState({waitingQue:i})):"uploading"===e?((i=this.state.uploadingQue).push(t),this.setState({uploadingQue:i})):"finished"===e?((i=this.state.finishedQue).push(t),this.setState({finishedQue:i})):"exist"===e&&((i=this.state.existQue).push(t),this.setState({existQue:i}))}},{key:"queRemove",value:function(e,t){if("init"===e){var i=this.state.initQue,n=i.indexOf(t);n>-1&&i.splice(n,1),this.setState({initQue:i})}else if("selected"===e){var s=this.state.selectedQue,a=s.indexOf(t);a>-1&&s.splice(a,1),this.setState({selectedQue:s})}else if("waiting"===e){var l=this.state.waitingQue,r=l.indexOf(t);r>-1&&l.splice(r,1),this.setState({waitingQue:l})}else if("uploading"===e){var o=this.state.uploadingQue,u=o.indexOf(t);u>-1&&o.splice(u,1),this.setState({uploadingQue:o})}else if("finished"===e){var c=this.state.finishedQue,d=c.indexOf(t);d>-1&&c.splice(d,1),this.setState({finishedQue:c})}else if("exist"===e){var h=this.state.existQue,f=h.indexOf(t);f>-1&&h.splice(f,1),this.setState({existQue:h})}}},{key:"onSelect",value:function(e){for(var t=this,i=function(){var i=n;for(s=0;s<t.state.files.length;s++)if(e[i].name===t.state.files[s].name)return"continue|loop1";(a={}).name=e[i].name,a.lastModified=e[i].lastModified,a.size=e[i].size,a.file=e[i];var r=(l=t.state.files).push(a)-1;t.setState({files:l},(function(){t.queAdd("init",r)}))},n=0;n<e.length;n++){var s,a,l;i()}}},{key:"onSuggestionChange",value:function(e,t){console.log("in chanignig");var i=this.state.files;i[e].suggestedIdx=t,i[e].showSuggestions=!1,this.setState({files:i})}},{key:"onUpload",value:function(e){if(this.state.uploadingQue.length<this.max_simultanous_uploads){this.queAdd("uploading",e);var t=this.state.files;t[e].uploading=!0,this.setState({files:t},this.upload(e))}else this.queAdd("waiting",e);this.queRemove("selected",e)}},{key:"onDelete",value:function(e){var t=this;fetch("/library/delete/?file_id="+this.state.files[e].server.id,{method:"DELETE"}).then((function(i){if(!i.ok)throw new Error("Unable to delete");var n=t.state.files;"server"in n[e]&&delete n[e].server,"suggestions"in n[e]&&delete n[e].suggestions,"suggestedIdx"in n[e]&&delete n[e].suggestedIdx,t.setState({files:n},(function(){t.queAdd("init",e),t.queRemove("exist",e)}))})).then((function(e){console.log(e)}))}},{key:"renderInit",value:function(){return s.a.createElement("div",null,"Initing ",this.state.initQue.length," files")}},{key:"renderSuggestionSearchBar",value:function(e){var t=this;return s.a.createElement("input",{onKeyUp:function(i){console.log(i.target.value,e),t.getSuggestions(i.target.value,e)}})}},{key:"renderSuggestions",value:function(e){var t=this;if(!("showSuggestions"in this.state.files[e]))return null;if(!this.state.files[e].showSuggestions)return null;if(!("suggestions"in this.state.files[e]))return null;console.log(this.state.files),console.log("suggest for ",e);var i=[];if(this.state.files[e].suggestions)for(var n=function(){var n=a;if(a===t.state.files[e].suggestedIdx)return"continue";i.push(s.a.createElement("div",{key:n,id:n,style:{height:"50px",cursor:"pointer"},onClick:function(){return t.onSuggestionChange(e,n)}},s.a.createElement(b,{type:"suggestion",title:t.state.files[e].suggestions[n].title,year:t.state.files[e].suggestions[n].year,imgUrl:t.state.files[e].suggestions[n].poster_url})))},a=0;a<this.state.files[e].suggestions.length;a++)n();return s.a.createElement("div",null,s.a.createElement("div",{style:{height:"50px",width:"100%"}},this.renderSuggestionSearchBar(e)),s.a.createElement("div",null,i))}},{key:"renderSelected",value:function(){for(var e=this,t=[],i=function(){var i=e.state.selectedQue[n];a=s.a.createElement("div",null,"Not found"),l=s.a.createElement("div",null,"No buttons"),e.state.files[i].suggestions&&(a=s.a.createElement("div",{style:{height:"50px"}},s.a.createElement(b,{type:"suggestion",title:e.state.files[i].suggestions[e.state.files[i].suggestedIdx].title,year:e.state.files[i].suggestions[e.state.files[i].suggestedIdx].year,imgUrl:e.state.files[i].suggestions[e.state.files[i].suggestedIdx].poster_url})),l=s.a.createElement("div",null,s.a.createElement("button",{onClick:function(){var t="https://imdb.com/title/"+e.state.files[i].suggestions[e.state.files[i].suggestedIdx].id;console.log(t),window.open(t,"_blank")}},"IMDB"),s.a.createElement("button",{onClick:function(){e.onUpload(i)}},"Upload"))),r=s.a.createElement("div",{style:{position:"relative",overflow:"auto"}},s.a.createElement("div",null,s.a.createElement("div",{style:{cursor:"pointer"},onClick:function(){var t=e.state.files;t[i].showSuggestions=!t[i].showSuggestions,e.setState({files:t})}},s.a.createElement("div",{style:{width:"100%"}},e.state.files[i].name),a),l,s.a.createElement("div",null,e.renderSuggestions(i)))),t.push(s.a.createElement("div",{key:i,id:i},r))},n=0;n<this.state.selectedQue.length;n++){var a,l,r;i()}return s.a.createElement("div",null,"Selected ",t.length," files",t)}},{key:"renderWaiting",value:function(){for(var e=[],t=0;t<this.state.waitingQue.length;t++){var i=this.state.waitingQue[t];e.push(s.a.createElement("div",{key:i,id:i},this.state.files[i].name))}return s.a.createElement("div",null,"Waiting ",e.length," files",e)}},{key:"renderUploading",value:function(){for(var e=[],t=0;t<this.state.uploadingQue.length;t++){var i=this.state.uploadingQue[t];e.push(s.a.createElement("div",{key:i,id:i},this.state.files[i].name,this.state.files[i].server.size_uploaded/this.state.files[i].server.size*100," %"))}return s.a.createElement("div",null,"Uploading ",e.length," files",e)}},{key:"renderFinished",value:function(){return s.a.createElement("div",null,"Finished ",this.state.finishedQue.length," files")}},{key:"renderExists",value:function(){for(var e=this,t=[],i=function(){var i=n;t.push(s.a.createElement("div",{key:i},e.state.files[e.state.existQue[i]].name,e.state.existQue[i],s.a.createElement("button",{onClick:function(){e.onDelete(e.state.existQue[i])}}," Delete and re-upload")))},n=0;n<this.state.existQue.length;n++)i();var a="Exists 0 files";return t.length>0&&(a="Following of the selected files found on in Library"),s.a.createElement("div",null,a,t)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement("input",{type:"file",accept:"*/*",multiple:!0,style:{},onChange:function(t){e.onSelect(t.target.files)}}),s.a.createElement("br",null),this.renderInit(),this.renderSelected(),this.renderWaiting(),this.renderUploading(),this.renderFinished(),this.renderExists())}}]),i}(s.a.Component),k=function(e){Object(u.a)(i,e);var t=Object(c.a)(i);function i(){return Object(r.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,[{key:"render",value:function(){return s.a.createElement("div",{className:"upload-application"},s.a.createElement(w,null))}}]),i}(s.a.Component),x=function(e){Object(u.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).state={titles:{},show:null},n.onShowTitle=n.onShowTitle.bind(Object(d.a)(n)),n}return Object(o.a)(i,[{key:"componentDidMount",value:function(){console.log("Fetching titles")}},{key:"componentDidUpdate",value:function(){}},{key:"onShowTitle",value:function(e){console.log("showing ",e),this.setState({show:e})}},{key:"renderShowTitle",value:function(){if(!this.state.show)return null;var e=this.state.titles[this.state.show];console.log(e);for(var t=[],i=0;i<e.stars.length;i++){var n=i;t.push(s.a.createElement("div",{key:n},s.a.createElement("div",null,e.stars[n].name),s.a.createElement("div",null)))}return s.a.createElement("div",null,s.a.createElement("div",{style:{display:"flex"}},s.a.createElement("img",{style:{},src:"/library/poster/?content_id="+e.id+"&w=300"}),s.a.createElement("div",{style:{}},s.a.createElement("div",{style:{fontWeight:"550",fontSize:"1.5em"}},e.title," (",e.year,")"),s.a.createElement("div",{style:{fontFamily:'"Apple Chancery","Bradley Hand", "Comic Sans MS"',fontSize:"1.3em"}},'"',e.tagline,'"'),s.a.createElement("div",{style:{borderTop:"1px solid black",display:"flex"}},s.a.createElement("div",{style:{width:"70%"}},s.a.createElement("div",null,e.directors[0].name),s.a.createElement("div",null,e.plot_short)),s.a.createElement("div",{style:{width:"30%"}},s.a.createElement("div",null,t),s.a.createElement("div",null,e.year),s.a.createElement("div",null,e.year))))),s.a.createElement("video",{width:"100%",controls:!0},s.a.createElement("source",{src:"/library/video/?content_id="+e.id,type:"video/mp4"})))}},{key:"render",value:function(){var e=this,t=[],i=this.state.titles;return Object.keys(this.state.titles).forEach((function(n){i[n]&&t.push(s.a.createElement("div",{key:n,style:{width:"186px"},onClick:function(){console.log(n),e.onShowTitle(n)}},s.a.createElement(b,{type:"cover",imgUrl:"/library/poster/?content_id="+i[n].id+"&w=186",title:i[n].title})))})),s.a.createElement("div",{style:{border:"2px solid gray",borderRadius:"10px",padding:"10px"},className:"browser-application"},this.renderShowTitle(),s.a.createElement("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"space-evenly",padding:"10px"}},t))}}]),i}(s.a.Component),S=function(e){Object(u.a)(i,e);var t=Object(c.a)(i);function i(){return Object(r.a)(this,i),t.call(this)}return Object(o.a)(i,[{key:"componentDidMount",value:function(){}},{key:"renderForm",value:function(){return s.a.createElement("div",null,s.a.createElement("div",{style:{cursor:"pointer",border:"1px solid black",height:"20px",width:"150px"}},"New collection"))}},{key:"render",value:function(){return s.a.createElement("div",{style:{border:"2px solid gray",borderRadius:"10px",padding:"10px"}},this.renderForm())}}]),i}(s.a.Component),O=function(e){Object(u.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.call(this)).state={library:null,collections:null,metadata:null},e}return Object(o.a)(i,[{key:"componentDidMount",value:function(){var e=this;fetch("/library/collection").then((function(e){if(e.ok)return e.json();throw new Error("No collections")})).then((function(t){e.setState({collections:t})})).catch((function(t){e.setState({collections:[]})})),fetch("/library/title/").then((function(e){if(e.ok)return e.json();throw new Error("Unable to fetch titles")})).then((function(t){console.log(t.titles),e.setState({library:t.titles},e.retrieveContentMetadata)})).catch((function(t){console.log(t),e.setState({library:[]}),e.setState({metadata:[]})}))}},{key:"retrieveContentMetadata",value:function(){var e=this;console.log("retriein metadata");var t="";this.state.library;console.log(this.state.library);for(var i=0;i<this.state.library.length;i++)console.log(this.state.library[i]),t+=this.state.library[i]+",";console.log(t),""!==t&&(console.log("to retr ",t),fetch("/metadata/movie/?id="+t).then((function(e){if(e.ok)return e.json();throw new Error("Unable to fetch metadata")})).then((function(t){console.log(t),e.setState({metadata:t})})).catch((function(e){console.log(e)})))}},{key:"renderContent",value:function(){return this.state.library&&this.state.collections?s.a.createElement("div",null,s.a.createElement(x,null),s.a.createElement(S,null)):null}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("div",{style:{width:"80%",margin:"0 auto",marginTop:"40px"}},s.a.createElement(k,null),this.renderContent()))}}]),i}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(O,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},8:function(e,t,i){e.exports=i(14)}},[[8,1,2]]]);
//# sourceMappingURL=main.bbac84ff.chunk.js.map